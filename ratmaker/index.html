<!DOCTYPE html>
<html>
  <head>
    <title>RatMaker‚Ñ¢Ô∏è</title>
    <link
      href="https://fonts.googleapis.com/css?family=Aldrich|Chakra+Petch|Frank+Ruhl+Libre|Open+Sans|Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link rel="shortcut icon" type="image/ico" href="favicon.ico" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <style>
      body,
      html {
        margin: 0px;
        width: 100%;
        min-height: 100%;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        padding: 20px;
        background-image: url('assets/page_background.png');
        background-size: cover;
        font-family: 'Aldrich', sans-serif;
        color: #8d5177;
      }

      img {
        image-rendering: pixelated;
        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;
      }

      * {
        box-sizing: border-box;
      }

      h2 {
        font-family: 'Press Start 2P', cursive;
        color: #ed83b5;
        font-size: 20px;
      }

      @keyframes wiggle {
        0% {
          box-shadow: 8px 8px 0px #ffb5d4, 16px 16px 0px #ffd4b4,
            24px 24px 0px #fff7dc;
        }
        50% {
          box-shadow: 8px 5px 0px #ffb5d4, 16px 8px 0px #ffd4b4,
            24px 14px 0px #fff7dc;
        }
        100% {
          box-shadow: 8px 8px 0px #ffb5d4, 16px 16px 0px #ffd4b4,
            24px 24px 0px #fff7dc;
        }
      }

      #container {
        width: 800px;
        padding: 32px;
        background: rgba(255, 240, 240, 0.85);
        border: 2px solid #fff;
        animation-name: wiggle;
        animation-duration: 1.5s;
        animation-iteration-count: infinite;
        animation-timing-function: ease-in-out;
        overflow: hidden;
      }

      #rat-selection {
        display: flex;
        flex-direction: row;
        padding-top: 20px;
      }

      /* custom scrollbar */
      ::-webkit-scrollbar {
        width: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #f5c1cf;
      }
      ::-webkit-scrollbar-thumb {
        background: #ed83b5;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #ed83b5;
      }

      #rat-options {
        overflow-y: scroll;
        background-color: #fffafb;
        padding: 10px;
        height: 600px;
      }

      /*smaller size media query*/
      @media (max-width: 780px) {
        #rat-selection {
          flex-wrap: wrap;
          padding-top: 0;
        }

        #rat-options {
          width: 100%;
          margin-top: 0px;
          height: auto;
        }

        #container {
          overflow: auto;
        }

        .download-button {
          display: none;
        }

        h1 {
          font-size: 20px;
          margin-bottom: 0;
        }

        h2 {
          font-size: 16px;
        }
      }

      .col {
        display: flex;
        flex-direction: column;
        width: 100%;
        justify-content: flex-start;
        align-items: center;
      }

      #big-ratitude {
        width: 300px;
        height: 400px;
        overflow: hidden;
        border-radius: 50%;
        position: relative;
        margin-bottom: 16px;
      }

      #big-ratitude img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      hr {
        border-top: 1px solid #ed83b577;
        margin: 24px 0px;
      }

      #frame {
        width: 100%;
        height: 100%;
        border-radius: 50%;

        position: absolute;
        top: 0px;
        left: 0px;
      }

      .rat-options-container {
        justify-content: left;
      }

      .option {
        padding: 8px;
        line-height: 32px;
        position: relative;
        z-index: 0;
        cursor: pointer;
      }

      .option:hover {
        color: #66ac5a;
      }

      h1 {
        margin-block-start: 0;
        font-family: 'Press Start 2P', cursive;
      }

      .checked {
        color: #66ac5a;
        outline-offset: -2px;
        outline: 2px solid #66ac5a;
        background: #e5f6e2;
        box-shadow: 2px 2px 0px #9cee8f;
      }

      .hidden {
        opacity: 0;
      }

      .download-button {
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        border: 3px solid #8d5177;
        color: #8d5177;
        height: 36px;
        width: 160px;
        background: #fffafb;
        margin-bottom: 13px;
      }

      .download-button:hover {
        background: #cbf5d6;
        cursor: pointer;
      }
      .other-button {
        font-family: 'Press Start 2P', cursive;
        font-size: 12px;
        border: 3px solid #8d5177;
        color: #8d5177;
        height: 36px;
        width: 160px;
        background: #fffafb;
        margin-bottom: 13px;
      }

      .other-button:hover {
        background: #cbf5d6;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <div id="container">
      <h1>ALGORat Generator</h1>
      <div id="rat-selection">
        <div class="col big-ratitude-container">
          <div id="big-ratitude">
            <img class="rat-image" src="assets/BLANK.png" />
            <div id="frame"></div>
          </div>
          <button class="other-button" onclick="reset()">reset!</button>
          <button class="other-button" onclick="randomize()">
            randomize!
          </button>
          <button class="download-button" onclick="saveImage()">
            download!
          </button>
        </div>
        <div class="col rat-options-container">
          <div id="rat-options">
            <h2>üå≤backgroundsüå≤</h2>
            <span class="option background" img-url="BACKGROUND_field.png"
              >field</span
            >
            <span class="option background" img-url="BACKGROUND_green.png"
              >green</span
            >
            <span class="option background" img-url="BACKGROUND_pink.png"
              >pink</span
            >
            <span class="option background" img-url="BACKGROUND_purple.png"
              >purple</span
            >
            <span class="option background" img-url="BACKGROUND_road.png"
              >road</span
            >
            <span class="option background" img-url="BACKGROUND_snow.png"
              >snow</span
            >
            <span class="option background" img-url="BACKGROUND_space.png"
              >space</span
            >
            <span class="option background" img-url="BACKGROUND_spooky.png"
              >spooky</span
            >
            <hr />
            <h2>üêÄbodiesüêÄ</h2>
            <span class="option body" img-url="BODY_beige.png">beige</span>
            <span class="option body" img-url="BODY_brown.png">brown</span>
            <span class="option body" img-url="BODY_green.png">green</span>
            <span class="option body" img-url="BODY_grey.png">grey</span>
            <span class="option body" img-url="BODY_yellow.png">yellow</span>
            <hr />
            <h2>üëÄeyesüëÄ</h2>
            <span class="option eyes" img-url="EYES_big.png">big</span>
            <span class="option eyes" img-url="EYES_big_spooky.png"
              >spooky</span
            >
            <span class="option eyes" img-url="EYES_closed.png">closed</span>
            <span class="option eyes" img-url="EYES_cyclops.png">cyclops</span>
            <span class="option eyes" img-url="EYES_dots.png">dots</span>
            <span class="option eyes" img-url="EYES_heart.png">heart</span>
            <span class="option eyes" img-url="EYES_hmm.png">hmm</span>
            <span class="option eyes" img-url="EYES_red.png">red</span>
            <span class="option eyes" img-url="EYES_wink.png">wink</span>
            <span class="option eyes" img-url="EYES_money.png">money</span>

            <hr />
            <h2>üëÑmouthsüëÑ</h2>
            <span class="option mouth" img-url="MOUTH_fangs.png">fangs</span>
            <span class="option mouth" img-url="MOUTH_line.png">line</span>
            <span class="option mouth" img-url="MOUTH_lips.png">lips</span>
            <span class="option mouth" img-url="MOUTH_o.png">o</span>
            <span class="option mouth" img-url="MOUTH_small_frown.png"
              >lil frown</span
            >
            <span class="option mouth" img-url="MOUTH_smile.png">smile</span>
            <span class="option mouth" img-url="MOUTH_teeth_frown.png"
              >teeth frown</span
            >

            <hr />
            <h2>üëúaccessoriesüëú</h2>
            <span class="option extra" img-url="EXTRA_adverserial.png"
              >adverserial</span
            >
            <span class="option extra" img-url="EXTRA_blush.png">blush</span>
            <span class="option extra" img-url="EXTRA_crown.png">crown</span>
            <span class="option extra" img-url="EXTRA_tear.png">tear</span>
            <span class="option extra" img-url="EXTRA_umm.png">grr</span>
            <hr />
            <h2>üíµdecorationsüíµ</h2>
            <span class="option foreground" img-url="FOREGROUND_diamonds.png"
              >diamonds</span
            >
            <span class="option foreground" img-url="FOREGROUND_money.png"
              >money</span
            >
            <span class="option foreground" img-url="FOREGROUND_roses.png"
              >roses</span
            >
            <span class="option foreground" img-url="FOREGROUND_grass.png"
              >grass</span
            >
            <hr />

            <h2>üíõfriendsüíõ</h2>
            <span class="option friend" img-url="FRIEND_alfie.png">alfie</span>
            <span class="option friend" img-url="FRIEND_Geoff.png">geoff</span>
            <span class="option friend" img-url="FRIEND_jeffry.png"
              >jeffry</span
            >
            <span class="option friend" img-url="FRIEND_langmore.png"
              >langmore</span
            >

            <hr />
            <h2>üñºframesüñº</h2>
            <span class="option frame" img-url="FRAME_flora.png">flora</span>
            <span class="option frame" img-url="FRAME_simple_gold.png"
              >gold</span
            >
            <span class="option frame" img-url="FRAME_black_line.png"
              >black line</span
            >
            <span class="option frame" img-url="FRAME_tails.png">tails</span>
          </div>
        </div>
      </div>
    </div>

    <script>
      const images = document.getElementById('big-ratitude');
      const soloClasses = [
        'eyes',
        'background',
        'body',
        'mouth',
        'frame',
        'foreground'
      ];

      function randomize() {
        reset();
        displayRandomFrom('eyes', 1);
        displayRandomFrom('background', 1);
        displayRandomFrom('body', 1);
        displayRandomFrom('mouth', 1);
        displayRandomFrom('frame', 1);
        displayRandomFrom('foreground', 1);
        displayRandomFrom('friend', 0);
        displayRandomFrom('extra', 0);
      }

      function displayRandomFrom(className, numItems) {
        const items = Array.from(document.getElementsByClassName(className));
        if (numItems === 0) numItems = Math.floor(Math.random() * items.length);
        for (let i = 0; i < numItems; i++) {
          const randomIndex = Math.floor(Math.random() * items.length);
          showImageElement(items[randomIndex]);
        }
      }

      function isHidden(element) {
        return !element.classList.contains('checked')
        console.log(element.classList.contains('checked'))
        //return (element.offsetParent === null)
      }

      function toggleFade(element){
        
        if (isHidden(element)){
         // showImageElement(element)
            //element.style.transition = '0.8s';
          //console.log("SHOW");
          showImageElement(element)

        }
        else{
            //element.style.transition = '0.8s';
         // console.log("SHOW");
          hideImageElement(element)
          //hideImageElement(element)
        }


      }

      function hideImageElement(element) {
       // if (element.classList.contains('checked')) {
          element.classList.remove('checked');
          document
            .getElementById(element.getAttribute('img-url'))
             .classList.toggle('hidden');
          //           document
          //   .getElementById(element.getAttribute('img-url'))
          //   .style.transition = '0.8s';
          //if (element)
          
          document.getElementById(element.getAttribute('img-url')).style.transition = '0.6s';
          document.getElementById(element.getAttribute('img-url')).style.opacity = 0;
                    
        //}
      }

      function showImageElement(element) {
        //if (!element.classList.contains('checked')) {
          element.classList.add('checked');
          document
            .getElementById(element.getAttribute('img-url'))
            .classList.toggle('hidden');
          // document
          //   .getElementById(element.getAttribute('img-url'))
          //   .style.transition = '0.8s';
          console.log("showing image element");
          document.getElementById(element.getAttribute('img-url')).style.transition = '0.5s';
          document.getElementById(element.getAttribute('img-url')).style.opacity = 1;
       // }
      }

      function reset() {
        const allImageElements = Array.from(
          document.getElementsByClassName('option')
        );
        allImageElements.forEach(imageElement =>
          hideImageElement(imageElement)
        );
      }

      function toggleItem(evt) {
        const element = evt.srcElement;
        soloClasses.forEach(soloClassName => {
          if (element.classList.contains(soloClassName)) {

            //if (document.getElementsByClassName(soloClassName))

            Array.from(document.getElementsByClassName(soloClassName)).forEach(
              soloClassItem => {
                if (soloClassItem.classList.contains('checked')) {
                  //soloClassItem.classList.remove('checked');
                  // document
                  //   .getElementById(soloClassItem.getAttribute('img-url'))
                  //   .classList.toggle('hidden');
                  console.log("calling hide img element")
                  hideImageElement(soloClassItem)
                }
              }
            );
          }
        });
        const imgUrl = element.getAttribute('img-url');

  //      if (!element.classList.contains('checked')){
//                    console.log("checked");

        //  return
       // }
        //else{
        
        toggleFade(element)
      //}
      //element.classList.toggle('checked');
     // document.getElementById(imgUrl).element.style.opacity = 1;//.classList.toggle('hidden');
      }

      document.querySelectorAll('.option').forEach(item => {
        item.addEventListener('click', toggleItem);
        const imgUrl = item.getAttribute('img-url');
        const newImage = document.createElement('IMG');

        newImage.src = 'assets/' + imgUrl;
        newImage.id = imgUrl;
        newImage.style.opacity = 0;
        newImage.classList.add('hidden');
        newImage.classList.add('rat-image');

        images.appendChild(newImage);
      });

      //saves image to local files
      function saveImage() {
        var canvas = document.createElement('CANVAS');
        var canWid = 300;
        var canHei = 364;

        canvas.width = canWid;
        canvas.height = canHei;
        canvas.style.width = canWid + 'px';
        canvas.style.height = canHei + 'px';

        var ctx = canvas.getContext('2d');

        Array.from(document.getElementsByClassName('rat-image')).forEach(
          img => {
            if (!img.classList.contains('hidden')) {
              ctx.drawImage(img, 0, 0, 300, 364);
            }
          }
        );

        var linkToClick = document.createElement('A'); //hacky solution to save file
        linkToClick.setAttribute('download', 'Rat-persona.png');
        linkToClick.setAttribute(
          'href',
          canvas
            .toDataURL('image/png')
            .replace('image/png', 'image/octet-stream')
        );
        linkToClick.click();
      }
    </script>
  </body>
</html>
